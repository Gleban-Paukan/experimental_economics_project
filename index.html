<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ğ”Ğ¸Ğ»ĞµĞ¼Ğ¼Ğ° Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ´ĞµÑ€Ğ¶ĞµĞº</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .game-container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        .screen { display: none; }
        .screen.active { display: block; }
        .player-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        .player-card.ready { border-left-color: #28a745; }
        .player-card.offline { border-left-color: #dc3545; opacity: 0.6; }
        .room-code {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 0.3rem;
            user-select: all;
        }
        .btn-primary { background: #667eea; border: none; }
        .btn-primary:hover { background: #5568d3; }
        .slider-container { margin: 30px 0; }
        .contribution-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        .result-success { background: #d4edda; border-left: 4px solid #28a745; }
        .result-fail { background: #f8d7da; border-left: 4px solid #dc3545; }
        .debug-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 0.85rem;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>

<div class="game-container">
    <!-- Ğ­ĞºÑ€Ğ°Ğ½ 1: Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ -->
    <div id="homeScreen" class="screen active">
        <h1 class="text-center mb-4">ğŸ® Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚</h1>
        <h5 class="text-center text-muted mb-4">Ğ”Ğ¸Ğ»ĞµĞ¼Ğ¼Ğ° Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ´ĞµÑ€Ğ¶ĞµĞº</h5>
        
        <div class="mb-4">
            <label class="form-label">Ğ’Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ:</label>
            <input type="text" id="playerName" class="form-control" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ" maxlength="20">
        </div>
        
        <div class="d-grid gap-3">
            <button class="btn btn-primary btn-lg" onclick="createRoom()">
                ğŸ  Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñƒ
            </button>
            <div class="text-center my-2">Ğ¸Ğ»Ğ¸</div>
            <div class="input-group">
                <input type="text" id="joinRoomCode" class="form-control" placeholder="ĞšĞ¾Ğ´ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹" maxlength="6">
                <button class="btn btn-success" onclick="joinRoom()">ĞŸÑ€Ğ¸ÑĞ¾ĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒÑÑ</button>
            </div>
        </div>
        
        <div class="alert alert-info mt-4">
            <strong>ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ°:</strong> 4 Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°, 5 Ñ€Ğ°ÑƒĞ½Ğ´Ğ¾Ğ². Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğµ Ğ±Ğ»Ğ°Ğ³Ğ¾ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğ¹ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (60-140). 
            Ğ•ÑĞ»Ğ¸ ÑÑƒĞ¼Ğ¼Ğ° Ğ²Ğ·Ğ½Ğ¾ÑĞ¾Ğ² â‰¥ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ â†’ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ 50 Ğ¼Ğ¾Ğ½ĞµÑ‚. Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ²Ğ·Ğ½Ğ¾ÑÑ‹ Ñ‚ĞµÑ€ÑÑÑ‚ÑÑ.
        </div>
    </div>

    <!-- Ğ­ĞºÑ€Ğ°Ğ½ 2: Ğ›Ğ¾Ğ±Ğ±Ğ¸ -->
    <div id="lobbyScreen" class="screen">
        <h2 class="text-center mb-4">ĞšĞ¾Ğ¼Ğ½Ğ°Ñ‚Ğ°</h2>
        <div class="text-center mb-4">
            <div class="room-code" id="displayRoomCode">------</div>
            <button class="btn btn-sm btn-outline-secondary" onclick="copyRoomCode()">ğŸ“‹ Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ´</button>
        </div>
        
        <h5>Ğ˜Ğ³Ñ€Ğ¾ĞºĞ¸ Ğ² ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ğµ (<span id="playerCount">0</span>/4):</h5>
        <div id="playersList"></div>
        
        <div class="d-grid gap-2 mt-4">
            <button class="btn btn-success btn-lg" id="readyBtn" onclick="markReady()">Ğ¯ Ğ³Ğ¾Ñ‚Ğ¾Ğ²!</button>
            <button class="btn btn-outline-danger" onclick="leaveRoom()">ĞŸĞ¾ĞºĞ¸Ğ½ÑƒÑ‚ÑŒ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñƒ</button>
        </div>
        
        <div class="alert alert-warning mt-3" id="waitingMessage">
            ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼, Ğ¿Ğ¾ĞºĞ° Ğ²ÑĞµ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¸ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹...
        </div>
    </div>

    <!-- Ğ­ĞºÑ€Ğ°Ğ½ 3: Ğ Ğ°ÑƒĞ½Ğ´ (Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·) -->
    <div id="beliefScreen" class="screen">
        <h3 class="text-center mb-4">Ğ Ğ°ÑƒĞ½Ğ´ <span id="currentRound1">1</span> Ğ¸Ğ· 5</h3>
        <h5 class="mb-4">ĞšĞ°Ğº Ğ²Ñ‹ Ğ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ, ĞºĞ°ĞºĞ¸Ğ¼Ğ¸ Ğ±ÑƒĞ´ÑƒÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ·Ğ´ĞµÑ€Ğ¶ĞºĞ¸?</h5>
        
        <div class="d-flex flex-column gap-2">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="belief" value="60" id="b60">
                <label class="form-check-label" for="b60">60 Ğ¼Ğ¾Ğ½ĞµÑ‚</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="belief" value="80" id="b80">
                <label class="form-check-label" for="b80">80 Ğ¼Ğ¾Ğ½ĞµÑ‚</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="belief" value="100" id="b100">
                <label class="form-check-label" for="b100">100 Ğ¼Ğ¾Ğ½ĞµÑ‚</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="belief" value="120" id="b120">
                <label class="form-check-label" for="b120">120 Ğ¼Ğ¾Ğ½ĞµÑ‚</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="belief" value="140" id="b140">
                <label class="form-check-label" for="b140">140 Ğ¼Ğ¾Ğ½ĞµÑ‚</label>
            </div>
        </div>
        
        <button class="btn btn-primary btn-lg w-100 mt-4" onclick="submitBelief()">Ğ”Ğ°Ğ»ĞµĞµ</button>
    </div>

    <!-- Ğ­ĞºÑ€Ğ°Ğ½ 4: Ğ Ğ°ÑƒĞ½Ğ´ (Ğ²Ğ·Ğ½Ğ¾Ñ) -->
    <div id="contributionScreen" class="screen">
        <h3 class="text-center mb-4">Ğ Ğ°ÑƒĞ½Ğ´ <span id="currentRound2">1</span> Ğ¸Ğ· 5</h3>
        <p class="text-center">Ğ’Ğ°Ñˆ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·: <strong><span id="beliefDisplay">-</span> Ğ¼Ğ¾Ğ½ĞµÑ‚</strong></p>
        
        <h5 class="mt-4">Ğ’Ğ°Ñˆ Ğ²Ğ·Ğ½Ğ¾Ñ:</h5>
        <div class="slider-container">
            <input type="range" class="form-range" min="0" max="100" value="25" id="contributionSlider" oninput="updateContributionValue()">
            <div class="text-center contribution-value" id="contributionValue">25</div>
        </div>
        
        <div class="alert alert-info">
            ğŸ’¡ Ğ•ÑĞ»Ğ¸ ÑÑƒĞ¼Ğ¼Ğ° Ğ²Ğ·Ğ½Ğ¾ÑĞ¾Ğ² â‰¥ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ·Ğ´ĞµÑ€Ğ¶ĞºĞ¸ â†’ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½!
        </div>
        
        <button class="btn btn-success btn-lg w-100" onclick="submitContribution()">ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ğ²Ğ·Ğ½Ğ¾Ñ</button>
    </div>

    <!-- Ğ­ĞºÑ€Ğ°Ğ½ 5: ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ -->
    <div id="waitingScreen" class="screen">
        <h3 class="text-center mb-4">ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²...</h3>
        <div class="text-center mb-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        <p class="text-center">Ğ˜Ğ³Ñ€Ğ¾ĞºĞ¾Ğ² Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾: <span id="readyCount">0</span>/4</p>
        <div id="playersStatusList"></div>
    </div>

    <!-- Ğ­ĞºÑ€Ğ°Ğ½ 6: Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ€Ğ°ÑƒĞ½Ğ´Ğ° -->
    <div id="resultsScreen" class="screen">
        <h3 class="text-center mb-4">Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ€Ğ°ÑƒĞ½Ğ´Ğ° <span id="resultsRound">1</span></h3>
        
        <div class="alert" id="resultStatus">
            <h4>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°</h4>
            <p>Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ·Ğ´ĞµÑ€Ğ¶ĞºĞ¸: <strong><span id="actualCost">-</span> Ğ¼Ğ¾Ğ½ĞµÑ‚</strong></p>
            <p>Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ²Ğ·Ğ½Ğ¾ÑĞ¾Ğ² Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹: <strong><span id="totalContribs">-</span> Ğ¼Ğ¾Ğ½ĞµÑ‚</strong></p>
            <p class="mb-0"><strong><span id="successStatus">-</span></strong></p>
        </div>
        
        <table class="table table-striped mt-4">
            <thead>
                <tr>
                    <th>Ğ˜Ğ³Ñ€Ğ¾Ğº</th>
                    <th>ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ·</th>
                    <th>Ğ’Ğ·Ğ½Ğ¾Ñ</th>
                    <th>Ğ’Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ</th>
                    <th>Ğ’ÑĞµĞ³Ğ¾</th>
                </tr>
            </thead>
            <tbody id="resultsTable"></tbody>
        </table>
        
        <button class="btn btn-primary btn-lg w-100 mt-3" onclick="nextRound()" id="nextRoundBtn">Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ñ€Ğ°ÑƒĞ½Ğ´</button>
    </div>

    <!-- Ğ­ĞºÑ€Ğ°Ğ½ 7: Ğ¤Ğ¸Ğ½Ğ°Ğ» -->
    <div id="finalScreen" class="screen">
        <h2 class="text-center mb-4">ğŸ† Ğ˜Ğ³Ñ€Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!</h2>
        
        <h4>Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°:</h4>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ĞœĞµÑÑ‚Ğ¾</th>
                    <th>Ğ˜Ğ³Ñ€Ğ¾Ğº</th>
                    <th>Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ ÑÑ‡Ñ‘Ñ‚</th>
                </tr>
            </thead>
            <tbody id="finalTable"></tbody>
        </table>
        
        <h5 class="mt-4">Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ€Ğ°ÑƒĞ½Ğ´Ğ¾Ğ²:</h5>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Ğ Ğ°ÑƒĞ½Ğ´</th>
                    <th>Ğ˜Ğ·Ğ´ĞµÑ€Ğ¶ĞºĞ¸</th>
                    <th>Ğ¡ÑƒĞ¼Ğ¼Ğ°</th>
                    <th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th>
                </tr>
            </thead>
            <tbody id="historyTable"></tbody>
        </table>
        
        <div class="d-grid gap-2 mt-4">
            <button class="btn btn-success btn-lg" onclick="downloadCSV()">ğŸ“¥ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ (CSV)</button>
            <button class="btn btn-outline-primary" onclick="location.reload()">Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ°</button>
        </div>
    </div>

    <!-- Debug Ğ»Ğ¾Ğ³ -->
    <div class="debug-log" id="debugLog"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ¯ (Ğ£Ğ–Ğ• Ğ’Ğ¡Ğ¢ĞĞ’Ğ›Ğ•ĞĞ!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey: "AIzaSyBdqtRnPhfqgYJYSMR5TZucmVHTuE4WTY8",
  authDomain: "cost-sharing-game.firebaseapp.com",
  databaseURL: "https://cost-sharing-game-default-rtdb.firebaseio.com",
  projectId: "cost-sharing-game",
  storageBucket: "cost-sharing-game.firebasestorage.app",
  messagingSenderId: "882128282715",
  appId: "1:882128282715:web:2fc86b8c68cbf3ccc44b7e"
};

// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ“Ğ›ĞĞ‘ĞĞ›Ğ¬ĞĞ«Ğ• ĞŸĞ•Ğ Ğ•ĞœĞ•ĞĞĞ«Ğ•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let roomCode = null;
let playerId = null;
let playerName = null;
let roomRef = null;
let currentBelief = null;
let isHost = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ£Ğ¢Ğ˜Ğ›Ğ˜Ğ¢Ğ«
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function log(message) {
    console.log(`[DEBUG] ${message}`);
    const debugLog = document.getElementById('debugLog');
    if (debugLog) {
        debugLog.style.display = 'block';
        debugLog.innerHTML += `${new Date().toLocaleTimeString()}: ${message}<br>`;
        debugLog.scrollTop = debugLog.scrollHeight;
    }
}

function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
    log(`ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½ ÑĞºÑ€Ğ°Ğ½: ${screenId}`);
}

function generateRoomCode() {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let code = '';
    for (let i = 0; i < 6; i++) {
        code += chars[Math.floor(Math.random() * chars.length)];
    }
    return code;
}

function generatePlayerId() {
    return 'player_' + Date.now() + '_' + Math.floor(Math.random() * 10000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ• Ğ˜ ĞŸĞ Ğ˜Ğ¡ĞĞ•Ğ”Ğ˜ĞĞ•ĞĞ˜Ğ• Ğš ĞšĞĞœĞĞĞ¢Ğ•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function createRoom() {
    const name = document.getElementById('playerName').value.trim();
    if (!name) {
        alert('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ!');
        return;
    }
    
    playerName = name;
    playerId = generatePlayerId();
    roomCode = generateRoomCode();
    isHost = true;
    
    log(`Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹: ${roomCode}, Ğ¸Ğ³Ñ€Ğ¾Ğº: ${playerName}`);
    
    roomRef = db.ref(`rooms/${roomCode}`);
    roomRef.set({
        status: 'waiting',
        currentRound: 1,
        host: playerId,
        roundCalculated: false,
        players: {
            [playerId]: {
                name: playerName,
                ready: false,
                score: 0,
                online: true,
                joinedAt: Date.now()
            }
        }
    }).then(() => {
        setupPresence();
        listenToRoom();
        showLobby();
    });
}

function joinRoom() {
    const name = document.getElementById('playerName').value.trim();
    const code = document.getElementById('joinRoomCode').value.trim().toUpperCase();
    
    if (!name || !code) {
        alert('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ Ğ¸ ĞºĞ¾Ğ´ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹!');
        return;
    }
    
    playerName = name;
    playerId = generatePlayerId();
    roomCode = code;
    
    log(`ĞŸÑ€Ğ¸ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğº ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ğµ: ${roomCode}`);
    
    roomRef = db.ref(`rooms/${roomCode}`);
    roomRef.once('value').then(snapshot => {
        if (!snapshot.exists()) {
            alert('ĞšĞ¾Ğ¼Ğ½Ğ°Ñ‚Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°!');
            return;
        }
        
        const roomData = snapshot.val();
        const playerCount = Object.keys(roomData.players || {}).length;
        
        if (playerCount >= 4) {
            alert('ĞšĞ¾Ğ¼Ğ½Ğ°Ñ‚Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ (4 Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°)!');
            return;
        }
        
        roomRef.child('players').child(playerId).set({
            name: playerName,
            ready: false,
            score: 0,
            online: true,
            joinedAt: Date.now()
        }).then(() => {
            setupPresence();
            listenToRoom();
            showLobby();
        });
    });
}

function setupPresence() {
    const playerRef = roomRef.child('players').child(playerId);
    playerRef.child('online').set(true);
    playerRef.child('online').onDisconnect().set(false);
}

function showLobby() {
    document.getElementById('displayRoomCode').textContent = roomCode;
    showScreen('lobbyScreen');
}

function copyRoomCode() {
    navigator.clipboard.writeText(roomCode);
    alert('ĞšĞ¾Ğ´ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!');
}

function markReady() {
    roomRef.child('players').child(playerId).update({ ready: true });
    document.getElementById('readyBtn').disabled = true;
    log('Ğ˜Ğ³Ñ€Ğ¾Ğº Ğ¾Ñ‚Ğ¼ĞµÑ‚Ğ¸Ğ»ÑÑ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğ¼');
}

function leaveRoom() {
    if (confirm('ĞŸĞ¾ĞºĞ¸Ğ½ÑƒÑ‚ÑŒ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñƒ?')) {
        roomRef.child('players').child(playerId).remove();
        location.reload();
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ¡Ğ›Ğ£Ğ¨ĞĞ¢Ğ•Ğ›Ğ¬ ĞšĞĞœĞĞĞ¢Ğ«
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function listenToRoom() {
    roomRef.on('value', snapshot => {
        if (!snapshot.exists()) return;
        
        const roomData = snapshot.val();
        log(`ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹, ÑÑ‚Ğ°Ñ‚ÑƒÑ: ${roomData.status}, Ñ€Ğ°ÑƒĞ½Ğ´: ${roomData.currentRound}`);
        
        if (roomData.status === 'waiting') {
            updateLobby(roomData);
            checkLobbyStart(roomData);
        } else if (roomData.status === 'playing') {
            handlePlayingState(roomData);
        } else if (roomData.status === 'finished') {
            showFinalResults(roomData);
        }
    });
}

function updateLobby(roomData) {
    const players = roomData.players || {};
    const playersList = document.getElementById('playersList');
    const playerCount = document.getElementById('playerCount');
    
    playerCount.textContent = Object.keys(players).length;
    
    let html = '';
    for (let pid in players) {
        const p = players[pid];
        const statusClass = p.ready ? 'ready' : (p.online ? '' : 'offline');
        const statusText = p.ready ? 'âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²' : (p.online ? 'â³ ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ' : 'ğŸ”´ ĞÑ„Ğ»Ğ°Ğ¹Ğ½');
        html += `<div class="player-card ${statusClass}">
            <strong>${p.name}</strong> ${statusText}
        </div>`;
    }
    playersList.innerHTML = html;
}

function checkLobbyStart(roomData) {
    const players = roomData.players || {};
    const all = Object.values(players);
    const readyCount = all.filter(p => p.ready).length;
    
    if (readyCount === all.length && all.length === 4) {
        log('Ğ’ÑĞµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹, ÑÑ‚Ğ°Ñ€Ñ‚ Ğ¸Ğ³Ñ€Ñ‹!');
        if (isHost) {
            roomRef.update({ status: 'playing', currentRound: 1 });
        }
    }
}

function handlePlayingState(roomData) {
    const myPlayer = roomData.players[playerId];
    
    if (!myPlayer) return;
    
    // Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ€Ğ°ÑƒĞ½Ğ´Ğ° (actualCost ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½)
    if (roomData.actualCost && roomData.roundCalculated === false) {
        showRoundResults(roomData);
        return;
    }
    
    // Ğ•ÑĞ»Ğ¸ Ñ ĞµÑ‰Ğµ Ğ½Ğµ ÑĞ´ĞµĞ»Ğ°Ğ» Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·
    if (myPlayer.belief === undefined) {
        document.getElementById('currentRound1').textContent = roomData.currentRound;
        showScreen('beliefScreen');
        return;
    }
    
    // Ğ•ÑĞ»Ğ¸ Ñ ĞµÑ‰Ğµ Ğ½Ğµ ÑĞ´ĞµĞ»Ğ°Ğ» Ğ²Ğ·Ğ½Ğ¾Ñ
    if (myPlayer.contribution === undefined) {
        document.getElementById('currentRound2').textContent = roomData.currentRound;
        document.getElementById('beliefDisplay').textContent = myPlayer.belief;
        showScreen('contributionScreen');
        return;
    }
    
    // Ğ•ÑĞ»Ğ¸ Ñ ready, Ğ½Ğ¾ Ğ½Ğµ Ğ²ÑĞµ
    if (myPlayer.ready) {
        showWaitingScreen(roomData);
        checkAllPlayersReady(roomData);
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ ĞĞ£ĞĞ”: ĞŸĞ ĞĞ“ĞĞĞ— Ğ˜ Ğ’Ğ—ĞĞĞ¡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function submitBelief() {
    const selected = document.querySelector('input[name="belief"]:checked');
    if (!selected) {
        alert('Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·!');
        return;
    }
    
    currentBelief = parseInt(selected.value);
    roomRef.child('players').child(playerId).update({ belief: currentBelief });
    log(`ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½: ${currentBelief}`);
}

function updateContributionValue() {
    const value = document.getElementById('contributionSlider').value;
    document.getElementById('contributionValue').textContent = value;
}

function submitContribution() {
    const contribution = parseInt(document.getElementById('contributionSlider').value);
    
    roomRef.child('players').child(playerId).update({
        contribution: contribution,
        ready: true,
        timestamp: Date.now()
    }).then(() => {
        log(`Ğ’Ğ·Ğ½Ğ¾Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½: ${contribution}`);
    });
}

function showWaitingScreen(roomData) {
    const players = roomData.players || {};
    const all = Object.values(players);
    const readyCount = all.filter(p => p.ready).length;
    
    document.getElementById('readyCount').textContent = readyCount;
    
    let html = '';
    for (let pid in players) {
        const p = players[pid];
        const status = p.ready ? 'âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²!' : 'â³ Ğ”ÑƒĞ¼Ğ°ĞµÑ‚...';
        html += `<div class="player-card ${p.ready ? 'ready' : ''}">
            <strong>${p.name}</strong>: ${status}
        </div>`;
    }
    document.getElementById('playersStatusList').innerHTML = html;
    
    showScreen('waitingScreen');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ ĞĞ¡Ğ§Ğ•Ğ¢ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢ĞĞ’
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkAllPlayersReady(roomData) {
    const players = roomData.players || {};
    const all = Object.values(players);
    const readyCount = all.filter(p => p.ready && p.contribution !== undefined).length;
    
    log(`ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸: ${readyCount}/${all.length}`);
    
    if (readyCount === all.length && all.length > 0 && !roomData.actualCost) {
        log('Ğ’ÑĞµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹! ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ñ€Ğ°ÑÑ‡ĞµÑ‚...');
        calculateRoundResults(roomData);
    }
}

function calculateRoundResults(roomData) {
    // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ transaction Ğ´Ğ»Ñ Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸
    roomRef.child('roundCalculated').transaction(current => {
        if (current === true) {
            log('Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ÑƒĞ¶Ğµ Ñ€Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ğ½Ñ‹');
            return current;
        }
        return true;
    }, (error, committed, snapshot) => {
        if (error) {
            log('ERROR: ' + error);
            return;
        }
        
        if (committed && snapshot.val() === true) {
            log('ĞœĞ« Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹!');
            performCalculation(roomData);
        }
    });
}

function performCalculation(roomData) {
    const players = roomData.players;
    const currentRound = roomData.currentRound;
    
    // Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ´ĞµÑ€Ğ¶ĞºĞ¸
    const costs = [60, 80, 100, 120, 140];
    const actualCost = costs[Math.floor(Math.random() * costs.length)];
    
    // Ğ¡ÑƒĞ¼Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ğ·Ğ½Ğ¾ÑÑ‹
    let totalContributions = 0;
    const contributions = {};
    const beliefs = {};
    
    for (let pid in players) {
        contributions[pid] = players[pid].contribution || 0;
        beliefs[pid] = players[pid].belief || 0;
        totalContributions += contributions[pid];
    }
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑƒÑĞ¿ĞµÑ…
    const success = totalContributions >= actualCost;
    
    // Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹ÑˆĞ¸
    const payoffs = {};
    for (let pid in players) {
        const contrib = contributions[pid];
        payoffs[pid] = success ? (50 - contrib) : (-contrib);
    }
    
    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ±Ğ°Ğ·Ñƒ
    const updates = {};
    updates.actualCost = actualCost;
    updates.totalContributions = totalContributions;
    updates.success = success;
    updates[`history/round${currentRound}`] = {
        actualCost,
        totalContributions,
        success,
        contributions,
        beliefs,
        payoffs,
        timestamp: Date.now()
    };
    
    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‡ĞµÑ‚Ğ° Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ² Ğ¸ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ ready
    for (let pid in players) {
        const newScore = (players[pid].score || 0) + payoffs[pid];
        updates[`players/${pid}/score`] = newScore;
        updates[`players/${pid}/ready`] = false;
        updates[`players/${pid}/belief`] = null;
        updates[`players/${pid}/contribution`] = null;
    }
    
    // Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ñ€Ğ°ÑƒĞ½Ğ´ Ğ¸Ğ»Ğ¸ Ñ„Ğ¸Ğ½Ğ°Ğ»
    if (currentRound < 5) {
        updates.currentRound = currentRound + 1;
        updates.status = 'playing';
    } else {
        updates.status = 'finished';
    }
    
    roomRef.update(updates).then(() => {
        log('Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹!');
        setTimeout(() => {
            roomRef.child('roundCalculated').set(false);
        }, 2000);
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞŸĞĞšĞĞ— Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢ĞĞ’
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showRoundResults(roomData) {
    const round = roomData.currentRound - 1; // Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°ÑƒĞ½Ğ´
    const history = roomData.history[`round${round}`];
    
    if (!history) return;
    
    document.getElementById('resultsRound').textContent = round;
    document.getElementById('actualCost').textContent = history.actualCost;
    document.getElementById('totalContribs').textContent = history.totalContributions;
    
    const statusDiv = document.getElementById('resultStatus');
    if (history.success) {
        statusDiv.classList.add('result-success');
        statusDiv.classList.remove('result-fail');
        document.getElementById('successStatus').textContent = 'âœ… ĞŸÑ€Ğ¾ĞµĞºÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½!';
    } else {
        statusDiv.classList.add('result-fail');
        statusDiv.classList.remove('result-success');
        document.getElementById('successStatus').textContent = 'âŒ ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»ĞµĞ½';
    }
    
    // Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
    let tableHtml = '';
    for (let pid in roomData.players) {
        const p = roomData.players[pid];
        const contrib = history.contributions[pid] || 0;
        const belief = history.beliefs[pid] || 0;
        const payoff = history.payoffs[pid] || 0;
        
        tableHtml += `<tr>
            <td>${p.name}</td>
            <td>${belief}</td>
            <td>${contrib}</td>
            <td>${payoff > 0 ? '+' : ''}${payoff}</td>
            <td><strong>${p.score}</strong></td>
        </tr>`;
    }
    document.getElementById('resultsTable').innerHTML = tableHtml;
    
    // ĞšĞ½Ğ¾Ğ¿ĞºĞ°
    const btn = document.getElementById('nextRoundBtn');
    if (roomData.currentRound > 5) {
        btn.textContent = 'Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹';
        btn.onclick = () => showFinalResults(roomData);
    } else {
        btn.textContent = 'Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ñ€Ğ°ÑƒĞ½Ğ´';
        btn.onclick = nextRound;
    }
    
    showScreen('resultsScreen');
}

function nextRound() {
    log('ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğº ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼Ñƒ Ñ€Ğ°ÑƒĞ½Ğ´Ñƒ');
    showScreen('beliefScreen');
}

function showFinalResults(roomData) {
    // Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¼ĞµÑÑ‚
    const players = Object.entries(roomData.players).map(([id, p]) => ({
        name: p.name,
        score: p.score
    })).sort((a, b) => b.score - a.score);
    
    let finalHtml = '';
    players.forEach((p, i) => {
        const medal = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : '';
        finalHtml += `<tr>
            <td>${medal} ${i + 1}</td>
            <td>${p.name}</td>
            <td><strong>${p.score}</strong></td>
        </tr>`;
    });
    document.getElementById('finalTable').innerHTML = finalHtml;
    
    // Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ€Ğ°ÑƒĞ½Ğ´Ğ¾Ğ²
    let histHtml = '';
    for (let i = 1; i <= 5; i++) {
        const h = roomData.history[`round${i}`];
        if (h) {
            histHtml += `<tr>
                <td>${i}</td>
                <td>${h.actualCost}</td>
                <td>${h.totalContributions}</td>
                <td>${h.success ? 'âœ…' : 'âŒ'}</td>
            </tr>`;
        }
    }
    document.getElementById('historyTable').innerHTML = histHtml;
    
    showScreen('finalScreen');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CSV Ğ­ĞšĞ¡ĞŸĞĞ Ğ¢
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function downloadCSV() {
    roomRef.once('value').then(snapshot => {
        const roomData = snapshot.val();
        
        let csv = 'roomCode,playerId,playerName,round,belief,contribution,actualCost,totalContributions,success,roundPayoff,totalScore\n';
        
        for (let r = 1; r <= 5; r++) {
            const h = roomData.history[`round${r}`];
            if (!h) continue;
            
            for (let pid in roomData.players) {
                const p = roomData.players[pid];
                csv += `${roomCode},${pid},${p.name},${r},${h.beliefs[pid]},${h.contributions[pid]},${h.actualCost},${h.totalContributions},${h.success},${h.payoffs[pid]},${p.score}\n`;
            }
        }
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `results_${roomCode}_${playerName}.csv`;
        a.click();
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
log('Ğ˜Ğ³Ñ€Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ°');
</script>

</body>
</html>
